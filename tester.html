<!doctype html>
<html>

<head>
	<title>Partial CVD Test</title>
	<link rel="stylesheet" href="css/index.css">
	</link>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	<link rel="icon" href="img/icon32x32.png" type="image/png" />
</head>

<body lang="en">
		<svg height="0" width="0">
			<defs>
				<filter id="protanopia" color-interpolation-filters="linearRGB">
					<feColorMatrix values="
		                    0.1120 0.8853 -0.0004 0 0
		                    0.1126 0.8897 -0.0001 0 0
		                    0.0045 0.0000 1.00191 0 0
		                    0 0 0 1 0" />
				</filter>
			</defs>
		</svg>
		<table>
			<thead>
				<th>Original</th>
				<th>JS (srgb)</th>
				<th>SVG (linear)</th>
				<th>JS (rec2020)</th>
				<th>JS (p3)</th>
				<th>JS (srgb decode)</th>
			</thead>
			<tr>
				<td>
					<img src="./img/color-test.svg">
				</td>
				<td>
					<wc-js-shader-canvas image="./img/color-test.svg" height="200" width="100">
						const protanopia = [
						[0.1120, 0.8853, -0.0005, 0],
						[0.1126, 0.8897, -0.0001, 0],
						[0.0045, 0.0001, 1.00191, 0],
						[0, 0, 0, 1]
						];
				
						const result=Matrix.crossMultiplyMatrixVector(color, protanopia);
						return result;
					</wc-js-shader-canvas>
				</td>
				<td>
					<img src="./img/color-test.svg" style="filter: url(#protanopia);">
				</td>
				<td>
				<wc-js-shader-canvas image="./img/color-test.svg" height="200" width="100" color-space="rec2020">
					const protanopia = [
					[0.1120, 0.8853, -0.0005, 0],
					[0.1126, 0.8897, -0.0001, 0],
					[0.0045, 0.0001, 1.00191, 0],
					[0, 0, 0, 1]
					];
				
					const result=Matrix.crossMultiplyMatrixVector(color, protanopia);
					return result;
				</wc-js-shader-canvas>
				</td>
				<td>
					<wc-js-shader-canvas image="./img/color-test.svg" height="200" width="100" color-space="display-p3">
						const protanopia = [
						[0.1120, 0.8853, -0.0005, 0],
						[0.1126, 0.8897, -0.0001, 0],
						[0.0045, 0.0001, 1.00191, 0],
						[0, 0, 0, 1]
						];
				
						const result=Matrix.crossMultiplyMatrixVector(color, protanopia);
						return result;
					</wc-js-shader-canvas>
				</td>
				<td>
				<wc-js-shader-canvas image="./img/color-test.svg" height="200" width="100">
					const protanopia = [
					[0.1120, 0.8853, -0.0005, 0],
					[0.1126, 0.8897, -0.0001, 0],
					[0.0045, 0.0001, 1.00191, 0],
					[0, 0, 0, 1]
					];
				
					function srgbToRgb(color) {
					return color.map(component => {
					const sign = component < 0 ? -1 : 1; const abs=Math.abs(component); let linear; if (abs <=0.04045) {
						linear=component / 12.92; } else { linear=sign * Math.pow((abs + 0.055) / 1.055, 2.4); } return linear; }); }
						function rgbToSrgb(color) { return color.map(component=> {
						if(component < 0.0031308){ return component * 12.92; } else { return 1.055 * Math.pow(component, 1/2.4) - 0.055
							} }); } const linear=srgbToRgb(color); const result=Matrix.crossMultiplyMatrixVector(linear, protanopia);
							const r2=rgbToSrgb(result); return r2; </wc-js-shader-canvas>
				</td>
			</tr>
		</table>
		<input type="color">
		<script src="./js/components/wc-glsl-shader-canvas.js" type="module"></script>
		<script src="./js/components/wc-js-shader-canvas.js" type="module"></script>
		<script src="./js/components/wc-wgsl-shader-canvas.js" type="module"></script>
</body>
</html>